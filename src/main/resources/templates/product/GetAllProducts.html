<!DOCTYPE html>
<html lang="zh-Hant-TW" xmlns:th="http://www.thymeleaf.org/">

<head>
    <meta charset="UTF-8">
    <title>商品管理 - TickitEasy 管理系統</title>

    <!-- 引入 DataTables 的 CSS 和 JS 檔案 -->
    <link href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <!-- SweetAlert2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<style>
        /* 外層容器，使用 flexbox 排版 */
        .search-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        /* 搜索框樣式 */
        .search-form {
            display: flex;
            align-items: center;
        }

        .search-form input {
            margin-right: 5px;
        }

        /* 新增商品按鈕與搜索框並排 */
        .add-product-form {
            margin-right: auto;
        }
    </style>
	


    <script>
        $(document).ready(function () {
            $('#productTable').DataTable({
                "language": {
                    "url": "https://cdn.datatables.net/plug-ins/1.11.5/i18n/zh-HANT.json"
                },
                "pageLength": 10,
                "responsive": true,
                "ordering": true,
                "searching": true
            });
        });



        function confirmDelete(form) {
            Swal.fire({
                title: "你確定要刪除嗎？",
                text: "此操作無法復原！",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "刪除",
                cancelButtonText: "取消"
            }).then((result) => {
                if (result.isConfirmed) {
                    // 用戶確認刪除，手動提交表單
                    Swal.fire({
                        title: "已刪除！",
                        text: "商品已經被成功刪除。",
                        icon: "success"
                    }).then(() => {
                        form.submit(); // 提交表單
                    });
                }
            });

            // 阻止表單的自動提交，等用户确认后再提交
            return false;
        }
    </script>

</head>

<body>
    <div th:replace="~{commons/adminHeader}"></div>

    <!--  這裡是網頁內容 >-->
    <h1>商品管理</h1>
    <div class="search-container">
    <form method="get" th:action="@{/add}" class="add-product-form">
        <input type="submit" value="新增商品" class="btn btn-primary">
    </form>
    
    
    <form th:action="@{/getAllProducts}" method="get" class="mb-4 search-form">
        <input type="text" name="productName" placeholder="輸入商品名稱" th:value="${param.productName}">
        <button type="submit">搜尋</button>
    </form>
</div>

    <!-- <form th:action="@{/getAllProducts}" method="get" class="mb-4">
        <input type="text" name="productName" placeholder="輸入商品名稱" th:value="${param.productName}">
        <button type="submit">搜索</button>
    </form> -->

    <table id="productTable" class="display">
        <thead>
            <tr>
                <th>商品編號</th>
                <th>分類</th>
                <th>標籤</th>
                <th>商品名稱</th>
                <th>商品圖片</th>
                <th>商品描述</th>
                <th>價格</th>
                <th>庫存</th>
                <th>狀態</th>
                <th>評論總數</th>
                <th>總評分</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="prod : ${product}">
                <td th:text="${prod.productID}"></td>
                <td th:text="${prod.productCategory != null} ? ${prod.productCategory.categoryName} : '無'"></td>
                <td th:text="${prod.productTag != null} ? ${prod.productTag.tagName} : '無'"></td>
                <td th:text="${prod.productName}"></td>
                <td><img th:src="@{${prod.productPic}}" alt="商品圖片" style="width: 100px;"> </td>
                <td th:text="${prod.productDesc}"></td>
                <td th:text="${prod.price}"></td>
                <td th:text="${prod.stock}"></td>
                <td th:text="${prod.status == 1} ? '上架' : '下架'"></td>
                <td th:text="${prod.prodTotalReviews}"></td>
                <td th:text="${prod.prodTotalScore}"></td>
                <td>
                    <form th:action="@{/getProductForUpdate}" method="get">
                        <input type="hidden" name="productID" th:value="${prod.productID}" />
                        <button type="submit" value="修改" class="btn btn-primary">修改</button>
                    </form>
                </td>
                <td>
                    <form th:action="@{/deleteProductById}" method="post" style="display:inline;"
                        onsubmit="return confirmDelete(this);">
                        <input type="hidden" name="productID" th:value="${prod.productID}" />
                        <button type="submit" class="btn btn-danger">刪除</button>
                    </form>
                </td>
            </tr>
        </tbody>
    </table>

    <div th:replace="~{commons/adminFooter}"></div>
</body>

</html>