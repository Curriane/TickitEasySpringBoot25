<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta th:replace="~{commons/adminHead}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <title>新增貼文</title>
    <style>
        body {
          font-family: Arial, sans-serif;
          background-color: #f4f4f4;
          margin: 0;
          margin-top: 100px;
          padding: 20px;
          color: #333;
        }
    
        h1 {
          text-align: center;
          color: #4CAF50;
        }
    
        form {
          background: white;
          padding: 20px;
          border-radius: 5px;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
          max-width: 600px;
          margin: 0 auto;
        }
    
        label {
          display: block;
          margin-bottom: 10px;
          font-weight: bold;
        }
    
        input[type="text"], textarea {
          width: 100%;
          padding: 10px;
          margin-bottom: 20px;
          border: 1px solid #ccc;
          border-radius: 5px;
          font-size: 16px;
        }
    
        .button {
          background-color: #4CAF50;
          color: white;
          padding: 10px 15px;
          border: none;
          border-radius: 5px;
          font-size: 16px;
          cursor: pointer;
          transition: background-color 0.3s;
          width: 100%;
        }
        .listbtn{
        width: 5%;
        }
        button:hover {
          background-color: #45a049;
        }
    
        #updateResult {
          margin-top: 20px;
          text-align: center;
          font-weight: bold;
          color: #d9534f; /* Red color for errors */
        }
    
        .success {
          color: #5cb85c; /* Green color for success */
        }
      </style>

</head>
<body>
    <div th:replace="~{commons/adminHeader}"></div>
   <h1>檢舉紀錄</h1>
    <table id="reportTable">
        <thead>
            <tr>
                <th>檢舉 ID</th>
                <th>檢舉者</th>
                <th>被檢舉者</th>
                <th>原因</th>
                <th>檢舉時間</th>
                <th>狀態</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            <!-- 檢舉紀錄將在這裡動態加載 -->
        </tbody>
    </table>
   
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
   // script.js
document.addEventListener("DOMContentLoaded", function () {
    fetchReports();
});

function fetchReports() {
    const apiUrl = "http://localhost:8080/TickitEasy/admin/api/reports"; // 更改為實際的 API 路徑
    
    fetch(apiUrl, {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${Auth.getToken()}`, // 使用實際的身份驗證令牌
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error("網絡響應出錯");
        }
        return response.json();
    })
    .then(data => {
        const reportTableBody = document.getElementById("reportTable").querySelector("tbody");
        reportTableBody.innerHTML = ""; // 清空表格內容

        data.forEach(report => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${report.reportID}</td>
                <td>${report.reportedMember.name}</td>
                <td>${report.accusedMember.name}</td>
                <td>${report.reason}</td>
                <td>${new Date(report.reportTime).toLocaleString()}</td>
                <td>${report.reportStatus === 1 ? "未處理" : "已處理"}</td>
                <td>
                    <button onclick="updateReportStatus(${report.reportID}, 2)">標記為已處理</button>
                </td>
            `;
            reportTableBody.appendChild(row);
        });
    })
    .catch(error => {
        console.error("獲取檢舉紀錄失敗:", error);
    });
}

function updateReportStatus(reportID, newStatus) {
    const apiUrl = `http://localhost:8080/TickitEasy/admin/api/report/${reportID}`; // 更新狀態的 API 路徑
    const requestBody = { reportStatus: newStatus };

    fetch(apiUrl, {
        method: 'PUT',
        headers: {
            'Authorization': `Bearer ${Auth.getToken()}`, // 使用實際的身份驗證令牌
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestBody)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error("網絡響應出錯");
        }
        return response.json();
    })
    .then(data => {
        alert(data.message);
        fetchReports(); // 重新加載報告以顯示更新
    })
    .catch(error => {
        console.error("更新檢舉狀態失敗:", error);
    });
}
   
        </script>
        <div th:replace="~{commons/adminFooter}"></div>
    </body>
</html>