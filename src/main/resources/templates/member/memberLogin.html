<!DOCTYPE html>
<html lang="zh-Hant-TW" xmlns:th="http://www.thymeleaf.org/">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- 引入共用的 Head -->
    <meta th:replace="~{commons/userHead}">
    
    <title>會員登入 - TickitEasy</title>
    
    <!-- 引入 SweetAlert2 和 Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <style>
        /* 背景色：非常淡的橘色 */
        body {
            background-color: #FFF8E1;
            font-family: 'Noto Sans TC', sans-serif;
        }

        .text-main-blue-purple {
            color: #5F46E8;
        }

        .btn-main-bright-orange {
            background-color: #FFB44D;
            border-color: #FFB44D;
            color: #fff;
        }

        .btn-main-bright-orange:hover {
            background-color: #F5BE74;
            border-color: #F5BE74;
            color: #fff;
        }

        /* 表單容器美化 */
        .login-container {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 500px;
            margin: auto;
            margin-top: 50px;
        }

        /* 第三方登入按鈕 */
        .btn-outline-danger {
            border-color: #DB4437;
            color: #DB4437;
        }

        .btn-outline-danger:hover {
            background-color: #DB4437;
            color: #fff;
        }

        .btn-outline-primary {
            border-color: #4267B2;
            color: #4267B2;
        }

        .btn-outline-primary:hover {
            background-color: #4267B2;
            color: #fff;
        }

        .text-muted {
            color: #6c757d !important;
        }
    </style>
</head>

<body>
    <!-- 引入共用的 Header -->
    <div th:replace="~{commons/userHeader}"></div>

    <div class="container">
        <div class="login-container">
            <h2 class="text-center text-main-blue-purple mb-4">會員登入</h2>

            <!-- 登入表單 -->
            <form id="loginForm">
                <div class="mb-3">
                    <label for="email" class="form-label">電子郵件</label>
                    <input type="email" class="form-control" id="email" placeholder="請輸入電子郵件" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">密碼</label>
                    <input type="password" class="form-control" id="password" placeholder="請輸入密碼" required>
                </div>
                <button type="submit" class="btn btn-main-bright-orange w-100">登入</button>
            </form>

            <!-- 第三方登入功能 -->
            <div class="text-center mt-4">
                <p class="text-muted">或使用第三方帳號登入</p>
                <div class="d-flex justify-content-center">
                    <button class="btn btn-outline-danger mx-2">
                        <i class="fab fa-google"></i> 使用 Google 登入
                    </button>
                    <button class="btn btn-outline-primary mx-2">
                        <i class="fab fa-facebook"></i> 使用 Facebook 登入
                    </button>
                </div>
            </div>

            <!-- 註冊新帳號 -->
            <div class="text-center mt-4">
                <p>還沒有 TickitEasy 帳號？<a href="/TickitEasy/member/register" class="text-main-blue-purple">前往註冊</a></p>
            </div>
        </div>
    </div>

    <!-- 引入共用的 Footer -->
    <div th:replace="~{commons/userFooter}"></div>

    <!-- 引入 SweetAlert2 和其他 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js"></script>

    <!-- 登入邏輯和 SweetAlert2 通知 -->
    <script>
        $(document).ready(function() {
    $('#loginForm').submit(function(e) {
        e.preventDefault();  // 阻止表單默認提交行為
        
        const email = $('#email').val();
        const password = $('#password').val();
        
        // 發送 AJAX 登入請求
        $.ajax({
            url: '/TickitEasy/member/login',  // 直接寫入實際的 URL
            type: 'POST',
            contentType: 'application/x-www-form-urlencoded',
            data: { email: email, password: password },
            success: function(response) {
                if (response.status === 'success') {
                    // 儲存 Token 到 localStorage
                    localStorage.setItem('jwtToken', response.token);

                    // SweetAlert2 成功提示
                    Swal.fire({
                        icon: 'success',
                        title: '登入成功',
                        text: '即將跳轉到首頁...',
                        timer: 2000,
                        showConfirmButton: false
                    }).then(() => {
                        window.location.href = '/TickitEasy/';  // 直接寫入實際的 URL
                    });
                } else {
                    // SweetAlert2 失敗提示
                    Swal.fire({
                        icon: 'error',
                        title: '登入失敗',
                        text: response.message
                    });
                }
            },
            error: function() {
                Swal.fire({
                    icon: 'error',
                    title: '登入失敗',
                    text: '伺服器錯誤，請稍後再試'
                });
            }
        });
    });
});
    </script>

</body>
</html>
